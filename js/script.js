$.fn.effectHide=function(t){let o={transitionProperty:t.props||"all",transitionDuration:(t.duration||300)+"ms"};return Object.assign(o,t.to),$(this).css(o),setTimeout(()=>{$(this).addClass("d-none"),t.after&&t.after.call(this)},(t.duration||300)+10),this},$.fn.effectShow=function(t){$(this).css(t.from||{}).removeClass("d-none");let o={transitionProperty:t.props||"all",transitionDuration:(t.duration||300)+"ms"};return Object.assign(o,t.to),setTimeout(()=>{$(this).css(o)},10),t.after&&setTimeout(()=>t.after.call(this),(t.duration||300)+15),this},$.fn.popupShow=function(){$(this).effectShow({from:{opacity:0},to:{opacity:"1"}}).find(".popup-window").effectShow({from:{transform:"translateY(-100px)"},to:{transform:"none"}}),$("html").css("overflow","hidden")},$.fn.popupHide=function(){$(this).effectHide({to:{opacity:"0"}}).find(".popup-window").effectHide({to:{transform:"translateY(-100px)"}}),$("html").css("overflow","")};
const qs=e=>document.querySelector(e),app={questions:{skip:[]},popup:{},validations:{},filebox:{},skip:[],hourLimit:14,timeLimit:25,startTime:(new Date).getTime(),isMobile:!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i),takeStep:function(e){let t=app.skip.concat(app.questions.skip).map(e=>"#"+e).join(",");t=`[step]:not(${t})`;let i=$(".current-step").removeClass("current-step");e?i=i.prevAll(t):(window.history.pushState("",""),i=i.nextAll(t)),i=i.first().addClass("current-step"),$("html").scrollTop(0),$(i).is("#uploading")&&app.uploading.setFolder()},backStep:()=>app.takeStep(!0)};$("[btn-skip]").click(()=>app.takeStep()),$("[btn-next]").click(function(){let e=qs(".current-step").id;"form"==e&&app.validations.step1()||["instructions"].includes(e)||qs(".current-step [file-box]")&&app.validations.filebox()?app.takeStep():($(this).addClass("shake"),setTimeout(()=>$(this).removeClass("shake"),1e3))}),$("[btn-back]").click(app.takeStep),$(".popup-container").click(function(e){(this==e.target||$(e.target).hasClass("icon-close"))&&$(this).popupHide()}),setInterval(()=>{((new Date).getTime()-app.startTime)/1e3/60>app.timeLimit&&!$("#form, #uploading, #success").is(".current-step")&&(alert(`Tempo Excedido!\nVocê tem um limite de ${app.timeLimit} minutos para enviar sua documentação.`),window.location.reload())},6e4);
$("#obra").on("change",function(){const e=$("#obra").val(),t=document.querySelector("#integra");if(!e)return t.innerHTML='<option value="">* Primeiro selecione a obra</option>',!1;const a=new Date,o=a.getDate()+1,r=a.getHours()>=app.hourLimit,i=[6,0].includes(a.getDay()),n=5==a.getDay(),s={jp:[1,4],ji:[1,3],jc:[1,3],jb:[2,4]};weekdays=["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"];let l=[];for(let e=0;e<30;e++){let e=a.getDate()+1;a.setDate(e),[6,0].includes(a.getDay())||l.push({date:a.getDate(),wkday:a.getDay(),formated:weekdays[a.getDay()]+" - "+a.toISOString().split("T")[0].split("-").reverse().join("/")})}t.innerHTML='<option value="">* Selecione a data da integração</option>',l.forEach((a,l)=>{if(s[e].includes(a.wkday)){let e=excepted="",s=a.date==o&&r,c=n&&1==a.wkday&&r&&l<3,d=i&&1==a.wkday&&l<3;(s||c||d)&&(e="disabled",excepted=" (horário excedido)"),t.innerHTML+=`<option value="${a.formated}" ${e}>${a.formated}${excepted}</option>`}}),t.value=""}),$("#obs").keyup(function(){this.style.height=this.scrollHeight+"px"}),app.validations.step1=function(){$("#form .border-danger").removeClass("border-danger"),$("#form p.text-danger").remove();let e=qs("#empresa"),t=qs("#email"),a=qs("#nome"),o=qs("#funcao"),r=qs("#obra"),i=qs("#integra"),n=(e,t)=>{$(e).addClass("border-danger").after(`<p class="text-danger"><small><i class="icon-warning"></i> ${t}</small></p>`)},s=/[A-zÀ-ú\s]{4,100}/;if(/[A-zÀ-ú\s\d]{2,100}/.test(e.value.trim()))if(/^[\w\.-]{2,}@[\w\.-]{2,}\.\w{2,}$/i.test(t.value.trim()))if(s.test(a.value.trim()))if(s.test(o.value.trim()))if(""==r.value)n(r,"Selecione a obra que o funcionário irá.");else{if(""!=i.value)return!0;n(i,"Selecione a data da integração.")}else n(o,"Insira a função corretamente. Use apenas letras.");else n(a,"Insira o nome do funcionário corretamente. Use apenas letras.");else n(t,"Insira seu email corretamente.");else n(e,"Insira sua empresa corretamente. Use apenas letras e números.");return $([document.documentElement,document.body]).animate({scrollTop:$(".current-step .border-danger").offset().top-40},300),!1},$("#video-tutorial").click(function(){$("#video-player").popupShow();let e=app.isMobile?$(window).width()-10:$(window).height();$("#video-player .popup-window").css({width:e,height:.8*e});let t=$("#video-player iframe");t.attr("src",t.attr("data-src"))}),$("#video-player").click(function(e){(e.target==this||$(e.target).hasClass("icon-close"))&&$("#video-player iframe").removeAttr("src")}),$("#form [btn-next]").mouseup(function(){let e,t=qs("#tipo-contrato").value;$(".container").attr("contrato",t),e="clt"==t?["contrato"]:["fr","ctps1","ctps2","ctpsAss","ctpsExp"];/ajudante|aj\.|aux|servente|estagi[áa]ri|meio oficial|1\/2 of/i.test(qs("#funcao").value)&&e.push("ctpsExp"),app.skip=e});
$("#instructions .card-link").click(function(){let t=$("#listaDocs");return t.hasClass("d-none")?t.effectShow({from:{maxHeight:"0"},to:{maxHeight:"1300px"},duration:1200}):t.effectHide({to:{maxHeight:"0"},duration:1200}),!1});
app.validations.filebox=function(){if(qs(".current-step [file-box] .file"))return!0;$(".current-step .alert").html('<i class="icon-warning"></i> Envie algum arquivo.').effectShow({from:{transform:"scale(1.2)"},to:{transform:"scale(1)"}})},$(".btn-add-files").click(function(){app.isMobile?$("#chooseFile").popupShow():qs(".current-step [fileInput]").click()}),$("#popup-jpg").click(function(){$(".current-step [fileInput]").attr("accept","image/jpeg").click(),$("#chooseFile").popupHide()}),$("#popup-pdf").click(function(){$(".current-step [fileInput]").attr("accept",".pdf, .jpg, .jpeg").click(),$("#chooseFile").popupHide()}),app.filebox.files=[],$("[fileInput]").change(function(i){let e=$(".current-step [file-box]"),o=$(".current-step .alert").addClass("d-none"),n="",s=function(i,e){o.html(`<h5 class="alert-heading">\n                <i class="icon-warning"></i> ${i}\n            </h5>\n            <span>${e}</span>`).effectShow({from:{transform:"scale(1.3)"},to:{transform:"scale(1)"}})},l=tooBig=[];Array.from(i.target.files).forEach(i=>{let e=i.name,o=Math.random();["image/jpeg","application/pdf"].includes(i.type)?i.size/1024/1024>3?tooBig.push(e):(app.filebox.files.push({id:o,data:i,type:i.size,step:qs(".current-step").id}),n+=function(i,e){return`<div class="file row">\n            <div class="col-11 p-0 overflow-hidden"><i class="icon-doc text-danger mr-2"></i>${i}</div>\n            <div class="col-1 p-0 align-self-center text-right pointer"><i class="icon-close" onclick="app.filebox.delFile(this, ${e})"></i></div>\n        </div>`}(e,o)):l.push(e)}),i.target.files.length>5||e.find(".file").length>4?s("Tudo isso?","<strong>Lembre-se: Um passo de cada vez.</strong> Você vai enviar \n             um documento por etapa, então, são permitidos até 5 arquivos por seção."):l.length?s("Tipo Inválido!",`O tipo dos arquivos abaixo é inválido. \n             Eles serão ignorados pois são aceitos somente arquivos JPG e PDF.\n             <ul class="mt-2 word-break">\n                <li>${l.join("</li><li>")}</li>\n             </ul>`):tooBig.length?s("Hum... Muito grande!",`Os arquivos abaixo são maiores que 3mb e serão ignorados. \n             Tente diminuí-los ou dividir as páginas em mais arquivos\n             <ul class="mt-2 word-break">\n                <li>${tooBig.join("</li><li>")}</li>\n             </ul>`):(e.find(".file-initial").addClass("d-none"),e.append(n))}),app.filebox.delFile=function(i,e){$(i).parents(".file").remove();let o=$(".current-step [file-box]");o.find(".file").length||o.find(".file-initial").removeClass("d-none"),app.filebox.files=app.filebox.files.filter(i=>i.id!=e)};
$("[question] button").click(function(){$(".current-question").toggleClass("current-question").effectHide({to:{marginLeft:"-60%",opacity:0},duration:200,after(){$(this).next("[question]").addClass("current-question").effectShow({from:{marginLeft:"60%",opacity:0},to:{marginLeft:0,opacity:1},duration:600}).length||app.takeStep()}});let t=$(this).attr("docName");t&&app.questions.skip.push(t)}),app.questions.reset=function(){$("[question]").removeAttr("style").addClass("d-none").removeClass("current-question").first().addClass("current-question").removeClass("d-none"),app.questions.skip=[]},$("#questions [btn-back]").click(app.questions.reset),$(".optional [btn-back]").blur(()=>$(".current-step").is("#questions")&&app.questions.reset());
app.uploading={counter:1,url:"https://script.google.com/macros/s/AKfycbwPqYCb0cyeuwbIHaHh000MmDD3qX1wEo_Qoos7Og4EEWVz64dv/exec",setFolder(){$.ajax({url:this.url,method:"post",data:{setFolder:!0},error:(...e)=>console.log("setFolder",e),success:e=>{let a=/^ID:/;a.test(e)?(this.folder=e.replace(a,""),$("#upl-title").html(`Enviando o <span id="upl-now">1</span>º \n                        de ${app.filebox.files.length} arquivos no total.`),this.singleUpload()):this.errorPage(e)}})},singleUpload(){app.filebox.files.forEach(async e=>{let a=await function(e){return new Promise((a,s)=>{let o=new FileReader;o.readAsDataURL(e),o.onload=()=>a(o.result),o.onerror=e=>s("Error: ",e)})}(e.data);a=a.replace(/[^,]+,/,""),$.ajax({method:"post",url:app.uploading.url,data:{single:!0,folder:this.folder,filedata:a,filetype:e.data.type,filename:e.step},error:(...e)=>console.log("singleUpload",e),success:e=>{if("ok"==e){let e=app.uploading.counter++,a=e/app.filebox.files.length*100;$("#uploading .progress-bar").width(a+"%"),$("#upl-now").html(e),e>=app.filebox.files.length&&this.finish()}else this.errorPage(e)}})})},finish(){$("#upl-title").html("Finalizando...");let e={folder:this.folder,finish:!0,empresa:qs("#empresa").value,email:qs("#email").value,nome:qs("#nome").value,funcao:qs("#funcao").value,obra:qs("#obra").value,integra:qs("#integra").value,obs:qs("#obs").value};$("#success [name]").text(e.nome),$("#success [date]").text(e.integra),$.ajax({url:this.url,method:"post",data:e,error:(...e)=>console.log("finish",e),success:e=>{"ok"==e?app.takeStep():this.errorPage(e)}})},errorPage(e){$("#error-msg").text(e),$(".current-step").removeClass("current-step"),$("#errorPage").addClass("current-step")}};
if($("#send-another").click(function(){let e={empresa:qs("#empresa").value,email:qs("#email").value,obra:qs("#obra").value};sessionStorage.repeat=JSON.stringify(e),window.location.reload()}),sessionStorage.repeat){items=JSON.parse(sessionStorage.repeat);for(let e in items)qs("#"+e).value=items[e];$("#obra").trigger("change"),sessionStorage.removeItem("repeat")}$("#error-tryAgain").click(function(){$("#upl-title").text($("#upl-title").attr("initial")),$("#errorPage, #uploading").toggleClass("current-step"),$("#uploading .progress-bar").width("0%"),app.uploading.counter=1,app.uploading.setFolder()});